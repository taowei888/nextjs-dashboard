# é™æ€å’ŒåŠ¨æ€æ¸²æŸ“æ–‡æ¡£

## æ¦‚è¿°
æœ¬æ–‡æ¡£è¯¦ç»†åˆ†æ Next.js ä»ªè¡¨æ¿é¡¹ç›®ä¸­çš„é™æ€æ¸²æŸ“å’ŒåŠ¨æ€æ¸²æŸ“å®ç°ï¼Œå±•ç¤ºä¸åŒæ¸²æŸ“ç­–ç•¥çš„åº”ç”¨åœºæ™¯å’Œæ€§èƒ½å½±å“ã€‚

## æ¸²æŸ“ç­–ç•¥æ¦‚è§ˆ

### Next.js App Router æ¸²æŸ“æ¨¡å¼
```
é™æ€æ¸²æŸ“ (Static Rendering)
â”œâ”€â”€ æ„å»ºæ—¶é¢„æ¸²æŸ“
â”œâ”€â”€ CDN ç¼“å­˜ä¼˜åŒ–
â””â”€â”€ é€‚ç”¨äºé™æ€å†…å®¹

åŠ¨æ€æ¸²æŸ“ (Dynamic Rendering)
â”œâ”€â”€ è¯·æ±‚æ—¶æ¸²æŸ“
â”œâ”€â”€ æœåŠ¡å™¨ç«¯æ‰§è¡Œ
â””â”€â”€ é€‚ç”¨äºä¸ªæ€§åŒ–å†…å®¹
```

## é¡¹ç›®ä¸­çš„æ¸²æŸ“å®ç°

### 1. é™æ€æ¸²æŸ“é¡µé¢

#### ä¸»é¡µ (`app/page.tsx`)
```typescript
// app/page.tsx:8-58
export default function Page() {
  return (
    <main className="flex min-h-screen flex-col p-6">
      {/* é™æ€å†…å®¹ï¼šLogoã€æ–‡æ¡ˆã€å›¾ç‰‡ */}
      <div className={styles.shape}>
        <AcmeLogo />
      </div>
      <p className={`${lusitana.className} text-xl text-gray-800`}>
        <strong>Welcome to Acme.</strong> This is the example...
      </p>
      <Image
        src="/hero-desktop.png"
        width={1000}
        height={760}
        className="hidden md:block"
        alt="Screenshots of the dashboard project"
      />
    </main>
  );
}
```

**é™æ€æ¸²æŸ“ç‰¹å¾ï¼š**
- âœ… æ— å¼‚æ­¥æ•°æ®è·å–
- âœ… æ— å¤–éƒ¨ä¾èµ–
- âœ… æ„å»ºæ—¶é¢„æ¸²æŸ“
- âœ… ä¼˜åŒ–çš„å›¾ç‰‡å¤„ç†

#### ç®€å•é¡µé¢ (`app/dashboard/invoices/page.tsx`)
```typescript
// app/dashboard/invoices/page.tsx:1-3
export default function Page() {
  return <p>invoices</p>;
}
```

**é™æ€æ¸²æŸ“ç‰¹å¾ï¼š**
- âœ… çº¯é™æ€å†…å®¹
- âœ… é›¶æ•°æ®ä¾èµ–
- âœ… æå¿«çš„åŠ è½½é€Ÿåº¦

### 2. åŠ¨æ€æ¸²æŸ“é¡µé¢

#### ä»ªè¡¨æ¿é¡µé¢ (`app/dashboard/page.tsx`)
```typescript
// app/dashboard/page.tsx:11-41
export default async function Page() {
  // ğŸ”„ åŠ¨æ€æ•°æ®è·å–
  const revenue = await fetchRevenue();
  const latestInvoices = await fetchLatestInvoices();
  const {
    numberOfInvoices,
    numberOfCustomers,
    totalPaidInvoices,
    totalPendingInvoices,
  } = await fetchCardData();

  return (
    <main>
      {/* åŸºäºæ•°æ®åº“æ•°æ®çš„åŠ¨æ€å†…å®¹ */}
      <Card title="Collected" value={totalPaidInvoices} type="collected" />
      <Card title="Pending" value={totalPendingInvoices} type="pending" />
      <RevenueChart revenue={revenue} />
      <LatestInvoices latestInvoices={latestInvoices} />
    </main>
  );
}
```

**åŠ¨æ€æ¸²æŸ“ç‰¹å¾ï¼š**
- ğŸ”„ `async` å‡½æ•°ç»„ä»¶
- ğŸ”„ æ•°æ®åº“æŸ¥è¯¢ä¾èµ–
- ğŸ”„ è¯·æ±‚æ—¶æ¸²æŸ“
- ğŸ”„ å®æ—¶æ•°æ®å±•ç¤º

## æ€§èƒ½æ¼”ç¤ºå’Œåˆ†æ

### æ•°æ®è·å–å»¶è¿Ÿæ¼”ç¤º
åœ¨ `app/lib/data.ts` ä¸­åŒ…å«æ€§èƒ½æ¼”ç¤ºä»£ç ï¼š

```typescript
// app/lib/data.ts:19-20,24
export async function fetchRevenue() {
  try {
    console.log('Fetching revenue data...');
    await new Promise((resolve) => setTimeout(resolve, 3000));

    const data = await sql<Revenue[]>`SELECT * FROM revenue`;

    console.log('Data fetch completed after 3 seconds.');
    return data;
  } catch (error) {
    // é”™è¯¯å¤„ç†
  }
}
```

### æ¸²æŸ“æ€§èƒ½å½±å“åˆ†æ

#### ğŸŒ åŠ¨æ€æ¸²æŸ“æ€§èƒ½å½±å“
```
ç”¨æˆ·è¯·æ±‚ â†’ æœåŠ¡å™¨å¤„ç† â†’ æ•°æ®åº“æŸ¥è¯¢ â†’ 3ç§’å»¶è¿Ÿ â†’ æ¸²æŸ“å®Œæˆ â†’ å“åº”è¿”å›
    â†“
æ€»å“åº”æ—¶é—´ï¼š3+ ç§’
```

#### âš¡ é™æ€æ¸²æŸ“æ€§èƒ½ä¼˜åŠ¿
```
ç”¨æˆ·è¯·æ±‚ â†’ CDNç¼“å­˜å‘½ä¸­ â†’ ç«‹å³å“åº”
    â†“
æ€»å“åº”æ—¶é—´ï¼š< 100ms
```

## æ¸²æŸ“æ¨¡å¼å†³ç­–æ ‘

### ä½•æ—¶ä½¿ç”¨é™æ€æ¸²æŸ“
```mermaid
graph TD
    A[é¡µé¢å†…å®¹] --> B{æ•°æ®æ˜¯å¦å˜åŒ–?}
    B -->|å¾ˆå°‘å˜åŒ–| C[é™æ€æ¸²æŸ“]
    B -->|é¢‘ç¹å˜åŒ–| D[åŠ¨æ€æ¸²æŸ“]

    C --> E[âœ… è¥é”€é¡µé¢]
    C --> F[âœ… æ–‡æ¡£é¡µé¢]
    C --> G[âœ… åšå®¢æ–‡ç« ]

    D --> H[ğŸ”„ ä»ªè¡¨æ¿]
    D --> I[ğŸ”„ ç”¨æˆ·é…ç½®]
    D --> J[ğŸ”„ å®æ—¶æ•°æ®]
```

### é¡¹ç›®é¡µé¢åˆ†ç±»

#### ğŸ“‹ é™æ€æ¸²æŸ“é¡µé¢
1. **ä¸»é¡µ** (`/`)
   - å†…å®¹ï¼šæ¬¢è¿é¡µé¢ã€Logoã€é™æ€å›¾ç‰‡
   - ä¼˜åŠ¿ï¼šæå¿«åŠ è½½ã€SEOå‹å¥½ã€CDNç¼“å­˜

2. **ç®€å•åŠŸèƒ½é¡µ** (`/dashboard/invoices`)
   - å†…å®¹ï¼šå ä½ç¬¦å†…å®¹
   - ä¼˜åŠ¿ï¼šé›¶å»¶è¿Ÿã€æ„å»ºæ—¶ä¼˜åŒ–

#### ğŸ”„ åŠ¨æ€æ¸²æŸ“é¡µé¢
1. **ä»ªè¡¨æ¿** (`/dashboard`)
   - å†…å®¹ï¼šå®æ—¶æ”¶å…¥å›¾è¡¨ã€æœ€æ–°å‘ç¥¨ã€ç»Ÿè®¡å¡ç‰‡
   - æ•°æ®æºï¼šPostgreSQL æ•°æ®åº“
   - æ›´æ–°é¢‘ç‡ï¼šæ¯æ¬¡è¯·æ±‚

## æ€§èƒ½ä¼˜åŒ–ç­–ç•¥

### é™æ€æ¸²æŸ“ä¼˜åŒ–

#### å›¾ç‰‡ä¼˜åŒ–
```typescript
// app/page.tsx:40-53
<Image
  src="/hero-desktop.png"
  width={1000}
  height={760}
  className="hidden md:block"
  alt="Screenshots of the dashboard project"
/>
```

**ä¼˜åŒ–ç‰¹æ€§ï¼š**
- âœ… è‡ªåŠ¨ WebP æ ¼å¼è½¬æ¢
- âœ… å“åº”å¼å›¾ç‰‡å°ºå¯¸
- âœ… æ‡’åŠ è½½ (Lazy Loading)
- âœ… ä¼˜åŒ–çš„å‹ç¼©ç®—æ³•

#### å­—ä½“ä¼˜åŒ–
```typescript
// app/page.tsx:5,18,27
import { lusitana, notoSansSC } from "@/app/ui/fonts";

<p className={`${lusitana.className} text-xl`}>
<p className={`${notoSansSC.className} text-xl`}>
```

**ä¼˜åŒ–ç‰¹æ€§ï¼š**
- âœ… å­—ä½“é¢„åŠ è½½
- âœ… å­—ä½“å­é›†åŒ–
- âœ… å‡å°‘å¸ƒå±€åç§»

### åŠ¨æ€æ¸²æŸ“ä¼˜åŒ–

#### å¹¶è¡Œæ•°æ®è·å–
```typescript
// app/dashboard/page.tsx:12-19
// âœ… å¥½çš„åšæ³•ï¼šå¹¶è¡Œè·å–ç‹¬ç«‹æ•°æ®
const revenue = await fetchRevenue();           // 3ç§’
const latestInvoices = await fetchLatestInvoices(); // ç‹¬ç«‹æŸ¥è¯¢
const cardData = await fetchCardData();         // å†…éƒ¨å¹¶è¡Œ

// æ€»æ—¶é—´ï¼šmax(3ç§’, å…¶ä»–æŸ¥è¯¢æ—¶é—´)
```

#### æ•°æ®åº“æŸ¥è¯¢ä¼˜åŒ–
```typescript
// app/lib/data.ts ä¸­çš„ä¼˜åŒ–ç­–ç•¥
export async function fetchCardData() {
  // âœ… Promise.all å¹¶è¡ŒæŸ¥è¯¢
  const data = await Promise.all([
    invoiceCountPromise,
    customerCountPromise,
    invoiceStatusPromise,
  ]);
}
```

## æ¸²æŸ“æ¨¡å¼å¯¹æ¯”

### æ€§èƒ½å¯¹æ¯”è¡¨
| ç‰¹æ€§ | é™æ€æ¸²æŸ“ | åŠ¨æ€æ¸²æŸ“ |
|------|----------|----------|
| **é¦–æ¬¡åŠ è½½** | < 100ms | 3000ms+ |
| **åç»­è®¿é—®** | < 50ms (ç¼“å­˜) | 3000ms+ |
| **æœåŠ¡å™¨è´Ÿè½½** | æä½ | é«˜ |
| **æ•°æ®å®æ—¶æ€§** | æ„å»ºæ—¶ | è¯·æ±‚æ—¶ |
| **SEOä¼˜åŒ–** | ä¼˜ç§€ | è‰¯å¥½ |
| **CDNç¼“å­˜** | å®Œå…¨æ”¯æŒ | ä¸é€‚ç”¨ |

### èµ„æºä½¿ç”¨å¯¹æ¯”
```
é™æ€æ¸²æŸ“ï¼š
â”œâ”€â”€ CPU ä½¿ç”¨ï¼šæ„å»ºæ—¶æ¶ˆè€—ï¼Œè¿è¡Œæ—¶å‡ ä¹ä¸ºé›¶
â”œâ”€â”€ å†…å­˜ä½¿ç”¨ï¼šæœ€å°åŒ–
â”œâ”€â”€ ç½‘ç»œå¸¦å®½ï¼šCDNåˆ†å‘ï¼Œå‡å°‘æºæœåŠ¡å™¨å‹åŠ›
â””â”€â”€ æ•°æ®åº“è¿æ¥ï¼šæ— 

åŠ¨æ€æ¸²æŸ“ï¼š
â”œâ”€â”€ CPU ä½¿ç”¨ï¼šæ¯ä¸ªè¯·æ±‚éƒ½æ¶ˆè€—
â”œâ”€â”€ å†…å­˜ä½¿ç”¨ï¼šä¿æŒæ•°æ®åº“è¿æ¥æ± 
â”œâ”€â”€ ç½‘ç»œå¸¦å®½ï¼šç›´æ¥ä»æºæœåŠ¡å™¨
â””â”€â”€ æ•°æ®åº“è¿æ¥ï¼šæ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦
```

## æ··åˆæ¸²æŸ“ç­–ç•¥

### å¢é‡é™æ€å†ç”Ÿ (ISR)
è™½ç„¶å½“å‰é¡¹ç›®æœªå®ç°ï¼Œä½†å¯ä»¥è€ƒè™‘çš„ä¼˜åŒ–æ–¹æ¡ˆï¼š

```typescript
// æœªæ¥å¯èƒ½çš„ ISR å®ç°
export const revalidate = 3600; // 1å°æ—¶é‡æ–°éªŒè¯

export default async function Page() {
  const data = await fetchStaticData();
  return <div>{data}</div>;
}
```

### å®¢æˆ·ç«¯æ•°æ®è·å–
å¯¹äºéå…³é”®æ•°æ®ï¼Œå¯ä»¥é‡‡ç”¨å®¢æˆ·ç«¯æ¸²æŸ“ï¼š

```typescript
// å¯èƒ½çš„å®¢æˆ·ç«¯æ•°æ®è·å–
'use client';

export default function NonCriticalData() {
  const [data, setData] = useState(null);

  useEffect(() => {
    fetch('/api/optional-data')
      .then(res => res.json())
      .then(setData);
  }, []);

  return data ? <div>{data}</div> : <div>Loading...</div>;
}
```

## ç›‘æ§å’Œè°ƒè¯•

### æ¸²æŸ“æ¨¡å¼è¯†åˆ«
```bash
# æ„å»ºæ—¶æ£€æŸ¥æ¸²æŸ“æ¨¡å¼
npm run build

# è¾“å‡ºç¤ºä¾‹ï¼š
# â—‹ /                    - é™æ€ç”Ÿæˆ
# â— /dashboard           - æœåŠ¡å™¨ç«¯æ¸²æŸ“ (SSR)
# â—‹ /dashboard/invoices  - é™æ€ç”Ÿæˆ
```

### æ€§èƒ½ç›‘æ§
```typescript
// åœ¨å¼€å‘ç¯å¢ƒä¸­ç›‘æ§æ¸²æŸ“æ€§èƒ½
console.log('Fetching revenue data...');    // å¼€å§‹æ—¶é—´
await new Promise((resolve) => setTimeout(resolve, 3000));
console.log('Data fetch completed after 3 seconds.'); // å®Œæˆæ—¶é—´
```

## æœ€ä½³å®è·µå»ºè®®

### 1. æ¸²æŸ“æ¨¡å¼é€‰æ‹©
- **é™æ€å†…å®¹** â†’ é™æ€æ¸²æŸ“
- **ä¸ªæ€§åŒ–æ•°æ®** â†’ åŠ¨æ€æ¸²æŸ“
- **æ··åˆå†…å®¹** â†’ åˆ†å±‚ç­–ç•¥

### 2. æ€§èƒ½ä¼˜åŒ–
- **æ•°æ®è·å–** â†’ ä½¿ç”¨å¹¶è¡ŒæŸ¥è¯¢
- **ç¼“å­˜ç­–ç•¥** â†’ é€‚å½“çš„ HTTP ç¼“å­˜å¤´
- **é”™è¯¯å¤„ç†** â†’ ä¼˜é›…é™çº§

### 3. å¼€å‘å·¥ä½œæµ
- **æµ‹è¯•ç¯å¢ƒ** â†’ å…³é—­äººå·¥å»¶è¿Ÿ
- **ç”Ÿäº§ç¯å¢ƒ** â†’ ç§»é™¤æ¼”ç¤ºå»¶è¿Ÿ
- **ç›‘æ§** â†’ å®æ–½æ€§èƒ½ç›‘æ§

## æœªæ¥ä¼˜åŒ–æ–¹å‘

### 1. æœåŠ¡ç«¯ç»„ä»¶ (RSC)
```typescript
// React Server Components è¿›ä¸€æ­¥ä¼˜åŒ–
import { Suspense } from 'react';

export default function Page() {
  return (
    <div>
      <StaticHeader />
      <Suspense fallback={<Loading />}>
        <DynamicData />
      </Suspense>
    </div>
  );
}
```

### 2. è¾¹ç¼˜è¿è¡Œæ—¶ä¼˜åŒ–
```typescript
// å¯èƒ½çš„è¾¹ç¼˜å‡½æ•°å®ç°
export const runtime = 'edge';

export default async function handler() {
  // åœ¨è¾¹ç¼˜èŠ‚ç‚¹æ‰§è¡Œçš„è½»é‡çº§é€»è¾‘
}
```

### 3. æµå¼æ¸²æŸ“
```typescript
// æµå¼ SSR æå‡æ„ŸçŸ¥æ€§èƒ½
import { Suspense } from 'react';

export default function StreamingPage() {
  return (
    <Suspense fallback={<Skeleton />}>
      <SlowComponent />
    </Suspense>
  );
}
```

## æ€»ç»“

é¡¹ç›®å®Œæ•´å±•ç¤ºäº† Next.js ä¸­é™æ€å’ŒåŠ¨æ€æ¸²æŸ“çš„æ˜æ˜¾å¯¹æ¯”ï¼š

### âœ… å½“å‰å®ç°
- **é™æ€é¡µé¢**ï¼šä¸»é¡µå’Œç®€å•åŠŸèƒ½é¡µå®ç°å¿«é€ŸåŠ è½½
- **åŠ¨æ€é¡µé¢**ï¼šä»ªè¡¨æ¿é¡µé¢å±•ç¤ºå®æ—¶æ•°æ®ï¼ˆå«3ç§’æ¼”ç¤ºå»¶è¿Ÿï¼‰
- **æ··åˆæ¶æ„**ï¼šæ ¹æ®å†…å®¹ç‰¹æ€§é€‰æ‹©åˆé€‚çš„æ¸²æŸ“ç­–ç•¥

### ğŸ“ˆ æ€§èƒ½å½±å“
- **é™æ€æ¸²æŸ“**ï¼š< 100ms å“åº”æ—¶é—´
- **åŠ¨æ€æ¸²æŸ“**ï¼š3000ms+ å“åº”æ—¶é—´ï¼ˆå«æ¼”ç¤ºå»¶è¿Ÿï¼‰
- **ä¼˜åŒ–ç©ºé—´**ï¼šç§»é™¤æ¼”ç¤ºå»¶è¿Ÿï¼Œå®æ–½ç¼“å­˜ç­–ç•¥

### ğŸš€ ä¼˜åŒ–å»ºè®®
1. ç”Ÿäº§ç¯å¢ƒç§»é™¤äººå·¥å»¶è¿Ÿ
2. å®æ–½é€‚å½“çš„ç¼“å­˜ç­–ç•¥
3. è€ƒè™‘ ISR ç”¨äºå‡†é™æ€å†…å®¹
4. ä½¿ç”¨ Suspense æ”¹å–„ç”¨æˆ·ä½“éªŒ