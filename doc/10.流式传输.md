# æµå¼ä¼ è¾“æ–‡æ¡£

## æ¦‚è¿°
æœ¬æ–‡æ¡£è¯¦ç»†ä»‹ç» Next.js ä»ªè¡¨æ¿é¡¹ç›®ä¸­çš„æµå¼ä¼ è¾“ï¼ˆStreamingï¼‰å®ç°ï¼Œå±•ç¤ºå¦‚ä½•ä½¿ç”¨ React Suspense å’Œ Next.js çš„æµå¼æ¸²æŸ“åŠŸèƒ½æ¥ä¼˜åŒ–ç”¨æˆ·ä½“éªŒå’Œé¡µé¢æ€§èƒ½ã€‚

## æµå¼ä¼ è¾“æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯æµå¼ä¼ è¾“
æµå¼ä¼ è¾“æ˜¯ä¸€ç§æ¸²æŸ“æŠ€æœ¯ï¼Œå…è®¸æœåŠ¡å™¨é€æ­¥å‘å®¢æˆ·ç«¯å‘é€ HTML ç‰‡æ®µï¼Œè€Œä¸éœ€è¦ç­‰å¾…æ‰€æœ‰æ•°æ®åŠ è½½å®Œæˆã€‚è¿™æ ·å¯ä»¥ï¼š

- âš¡ **æå‡æ„ŸçŸ¥æ€§èƒ½** - ç”¨æˆ·æ›´å¿«çœ‹åˆ°é¡µé¢å†…å®¹
- ğŸ”„ **å¹¶è¡Œæ•°æ®è·å–** - ä¸åŒç»„ä»¶å¯ä»¥ç‹¬ç«‹åŠ è½½æ•°æ®
- ğŸ¯ **ä¼˜åŒ–ç”¨æˆ·ä½“éªŒ** - æ˜¾ç¤ºåŠ è½½çŠ¶æ€è€Œéç©ºç™½é¡µé¢

### ä¼ ç»Ÿæ¸²æŸ“ vs æµå¼ä¼ è¾“

#### ä¼ ç»ŸæœåŠ¡å™¨ç«¯æ¸²æŸ“
```
è¯·æ±‚ â†’ è·å–æ‰€æœ‰æ•°æ® â†’ æ¸²æŸ“å®Œæ•´é¡µé¢ â†’ å‘é€å“åº”
      (ç­‰å¾…æœ€æ…¢çš„æ•°æ®æº)
```

#### æµå¼ä¼ è¾“æ¸²æŸ“
```
è¯·æ±‚ â†’ å‘é€åˆå§‹HTML â†’ é€æ­¥å‘é€æ•°æ® â†’ å®æ—¶æ›´æ–°é¡µé¢
      (ç«‹å³æ˜¾ç¤ºå¸ƒå±€)   (æ˜¾ç¤ºéª¨æ¶å±)   (æ›¿æ¢ä¸ºçœŸå®å†…å®¹)
```

## é¡¹ç›®ä¸­çš„æµå¼ä¼ è¾“å®ç°

### æ¶æ„é‡æ„

é¡¹ç›®ä»ä¼ ç»Ÿçš„å•ä¸€é¡µé¢æ¶æ„é‡æ„ä¸ºæ”¯æŒæµå¼ä¼ è¾“çš„æ¶æ„ï¼š

#### æ—§æ¶æ„ (`app/dashboard/page.tsx` - å·²åˆ é™¤)
```typescript
// ä¼ ç»Ÿæ–¹å¼ï¼šä¸²è¡Œæ•°æ®è·å–
export default async function Page() {
  const revenue = await fetchRevenue();           // ç­‰å¾…3ç§’
  const latestInvoices = await fetchLatestInvoices(); // ç­‰å¾…å®Œæˆ
  const cardData = await fetchCardData();         // ç­‰å¾…å®Œæˆ

  return (
    <main>
      {/* æ‰€æœ‰æ•°æ®å‡†å¤‡å¥½åæ‰æ¸²æŸ“ */}
      <Card title="Collected" value={totalPaidInvoices} />
      <RevenueChart revenue={revenue} />
      <LatestInvoices latestInvoices={latestInvoices} />
    </main>
  );
}
```

#### æ–°æ¶æ„ (`app/dashboard/(overview)/page.tsx`)
```typescript
// æµå¼ä¼ è¾“ï¼šå¹¶è¡Œæ•°æ®è·å– + Suspense
import { Suspense } from "react";

export default async function Page() {
  // åªè·å–å¿«é€Ÿæ•°æ®
  const cardData = await fetchCardData();

  return (
    <main>
      <h1>Dashboard</h1>

      {/* å¡ç‰‡ç»„ä»¶ç‹¬ç«‹åŠ è½½ */}
      <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <Suspense fallback={<CardsSkeleton />}>
          <CardWrapper />
        </Suspense>
      </div>

      {/* å›¾è¡¨å’Œå‘ç¥¨åˆ—è¡¨å¹¶è¡ŒåŠ è½½ */}
      <div className="mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8">
        <Suspense fallback={<RevenueChartSkeleton />}>
          <RevenueChart />
        </Suspense>
        <Suspense fallback={<LatestInvoicesSkeleton />}>
          <LatestInvoices />
        </Suspense>
      </div>
    </main>
  );
}
```

### ç»„ä»¶æ•°æ®è·å–é‡æ„

#### å¡ç‰‡ç»„ä»¶ (`app/ui/dashboard/cards.tsx`)
```typescript
// ä»æ¥æ”¶ props æ”¹ä¸ºè‡ªè¡Œè·å–æ•°æ®
import { fetchCardData } from "@/app/lib/data";

export default async function CardWrapper() {
  const {
    numberOfInvoices,
    numberOfCustomers,
    totalPaidInvoices,
    totalPendingInvoices,
  } = await fetchCardData();

  return (
    <>
      <Card title="Collected" value={totalPaidInvoices} type="collected" />
      <Card title="Pending" value={totalPendingInvoices} type="pending" />
      <Card title="Total Invoices" value={numberOfInvoices} type="invoices" />
      <Card title="Total Customers" value={numberOfCustomers} type="customers" />
    </>
  );
}
```

#### æ”¶å…¥å›¾è¡¨ç»„ä»¶ (`app/ui/dashboard/revenue-chart.tsx`)
```typescript
// è‡ªè¡Œè·å–æ”¶å…¥æ•°æ®
import { fetchRevenue } from "@/app/lib/data";

export default async function RevenueChart() {
  const revenue = await fetchRevenue(); // åŒ…å«3ç§’å»¶è¿Ÿ
  const chartHeight = 350;

  return (
    <div className="w-full md:col-span-4">
      {/* å›¾è¡¨æ¸²æŸ“é€»è¾‘ */}
    </div>
  );
}
```

#### æœ€æ–°å‘ç¥¨ç»„ä»¶ (`app/ui/dashboard/latest-invoices.tsx`)
```typescript
// è‡ªè¡Œè·å–å‘ç¥¨æ•°æ®
import { fetchLatestInvoices } from "@/app/lib/data";

export default async function LatestInvoices() {
  const latestInvoices = await fetchLatestInvoices();

  return (
    <div className="flex w-full flex-col md:col-span-4">
      {/* å‘ç¥¨åˆ—è¡¨æ¸²æŸ“é€»è¾‘ */}
    </div>
  );
}
```

## éª¨æ¶å±ç»„ä»¶ç³»ç»Ÿ

### è®¾è®¡åŸåˆ™
éª¨æ¶å±ï¼ˆSkeletonï¼‰ç»„ä»¶æ¨¡æ‹ŸçœŸå®å†…å®¹çš„å¸ƒå±€å’Œå½¢çŠ¶ï¼š

```typescript
// app/ui/skeletons.tsx
const shimmer =
  'before:absolute before:inset-0 before:-translate-x-full before:animate-[shimmer_2s_infinite] before:bg-gradient-to-r before:from-transparent before:via-white/60 before:to-transparent';
```

### å¡ç‰‡éª¨æ¶å±
```typescript
export function CardSkeleton() {
  return (
    <div className={`${shimmer} relative overflow-hidden rounded-xl bg-gray-100 p-2 shadow-sm`}>
      <div className="flex p-4">
        <div className="h-5 w-5 rounded-md bg-gray-200" /> {/* å›¾æ ‡ */}
        <div className="ml-2 h-6 w-16 rounded-md bg-gray-200" /> {/* æ ‡é¢˜ */}
      </div>
      <div className="flex items-center justify-center truncate rounded-xl bg-white px-4 py-8">
        <div className="h-7 w-20 rounded-md bg-gray-200" /> {/* æ•°å€¼ */}
      </div>
    </div>
  );
}

export function CardsSkeleton() {
  return (
    <>
      <CardSkeleton />
      <CardSkeleton />
      <CardSkeleton />
      <CardSkeleton />
    </>
  );
}
```

### æ”¶å…¥å›¾è¡¨éª¨æ¶å±
```typescript
export function RevenueChartSkeleton() {
  return (
    <div className={`${shimmer} relative w-full overflow-hidden md:col-span-4`}>
      <div className="mb-4 h-8 w-36 rounded-md bg-gray-100" />
      <div className="rounded-xl bg-gray-100 p-4">
        <div className="sm:grid-cols-13 mt-0 grid h-[410px] grid-cols-12 items-end gap-2 rounded-md bg-white p-4 md:gap-4" />
        <div className="flex items-center pb-2 pt-6">
          <div className="h-5 w-5 rounded-full bg-gray-200" />
          <div className="ml-2 h-4 w-20 rounded-md bg-gray-200" />
        </div>
      </div>
    </div>
  );
}
```

### å‘ç¥¨åˆ—è¡¨éª¨æ¶å±
```typescript
export function InvoiceSkeleton() {
  return (
    <div className="flex flex-row items-center justify-between border-b border-gray-100 py-4">
      <div className="flex items-center">
        <div className="mr-2 h-8 w-8 rounded-full bg-gray-200" /> {/* å¤´åƒ */}
        <div className="min-w-0">
          <div className="h-5 w-40 rounded-md bg-gray-200" /> {/* å§“å */}
          <div className="mt-2 h-4 w-12 rounded-md bg-gray-200" /> {/* é‚®ç®± */}
        </div>
      </div>
      <div className="mt-2 h-4 w-12 rounded-md bg-gray-200" /> {/* é‡‘é¢ */}
    </div>
  );
}

export function LatestInvoicesSkeleton() {
  return (
    <div className={`${shimmer} relative flex w-full flex-col overflow-hidden md:col-span-4`}>
      <div className="mb-4 h-8 w-36 rounded-md bg-gray-100" />
      <div className="flex grow flex-col justify-between rounded-xl bg-gray-100 p-4">
        <div className="bg-white px-6">
          <InvoiceSkeleton />
          <InvoiceSkeleton />
          <InvoiceSkeleton />
          <InvoiceSkeleton />
          <InvoiceSkeleton />
        </div>
      </div>
    </div>
  );
}
```

## è·¯ç”±çº§åˆ«çš„åŠ è½½çŠ¶æ€

### å®Œæ•´é¡µé¢éª¨æ¶å±
```typescript
// app/dashboard/(overview)/loading.tsx
import DashboardSkeleton from "@/app/ui/skeletons";

export default function Loading() {
  return <DashboardSkeleton />;
}
```

### ä»ªè¡¨æ¿éª¨æ¶å±
```typescript
export default function DashboardSkeleton() {
  return (
    <>
      <div className={`${shimmer} relative mb-4 h-8 w-36 overflow-hidden rounded-md bg-gray-100`} />
      <div className="grid gap-6 sm:grid-cols-2 lg:grid-cols-4">
        <CardSkeleton />
        <CardSkeleton />
        <CardSkeleton />
        <CardSkeleton />
      </div>
      <div className="mt-6 grid grid-cols-1 gap-6 md:grid-cols-4 lg:grid-cols-8">
        <RevenueChartSkeleton />
        <LatestInvoicesSkeleton />
      </div>
    </>
  );
}
```

## æ€§èƒ½ä¼˜åŒ–æ•ˆæœ

### åŠ è½½æ—¶åºå¯¹æ¯”

#### ä¼ ç»Ÿæ–¹å¼
```
æ—¶é—´è½´ï¼š0s -------- 3s -------- 3.5s
       ç©ºç™½é¡µé¢    ç­‰å¾…æ•°æ®    æ˜¾ç¤ºå®Œæ•´é¡µé¢

ç”¨æˆ·ä½“éªŒï¼šğŸ˜´ é•¿æ—¶é—´ç©ºç™½ â†’ ğŸ˜Š çªç„¶æ˜¾ç¤ºå®Œæ•´å†…å®¹
```

#### æµå¼ä¼ è¾“
```
æ—¶é—´è½´ï¼š0s - 0.1s - 0.2s --- 3s --- 3.5s
       éª¨æ¶å±  å¡ç‰‡   å‘ç¥¨    å›¾è¡¨   å®Œæˆ

ç”¨æˆ·ä½“éªŒï¼šğŸ˜Š ç«‹å³çœ‹åˆ°å¸ƒå±€ â†’ ğŸ˜Š é€æ­¥æ˜¾ç¤ºå†…å®¹ â†’ ğŸ˜Š å…¨éƒ¨å®Œæˆ
```

### æ•°æ®è·å–å¹¶è¡ŒåŒ–

```typescript
// å¹¶è¡Œæ‰§è¡Œï¼Œæ€»æ—¶é—´ = max(å„ç»„ä»¶åŠ è½½æ—¶é—´)
Promise.all([
  fetchCardData(),      // å¿«é€ŸæŸ¥è¯¢
  fetchLatestInvoices(), // ä¸­ç­‰æŸ¥è¯¢
  fetchRevenue()        // æ…¢æŸ¥è¯¢ (3ç§’)
]);

// è€Œä¸æ˜¯ä¸²è¡Œæ‰§è¡Œ
// æ€»æ—¶é—´ = æ‰€æœ‰æŸ¥è¯¢æ—¶é—´ä¹‹å’Œ
```

## å®ç°ç»†èŠ‚

### Next.js App Router æ”¯æŒ
```typescript
// app/dashboard/(overview)/page.tsx
// è·¯ç”±ç»„ (overview) å…è®¸å…±äº« layout å’Œ loading
```

### React Suspense é›†æˆ
```typescript
import { Suspense } from "react";

// Suspense è¾¹ç•Œå®šä¹‰åŠ è½½çŠ¶æ€
<Suspense fallback={<ComponentSkeleton />}>
  <AsyncComponent />
</Suspense>
```

### CSS åŠ¨ç”»æ•ˆæœ
```css
/* éª¨æ¶å±é—ªçƒåŠ¨ç”» */
.shimmer {
  position: relative;
  overflow: hidden;
}

.shimmer::before {
  content: '';
  position: absolute;
  inset: 0;
  transform: translateX(-100%);
  animation: shimmer 2s infinite;
  background: linear-gradient(
    90deg,
    transparent,
    rgba(255, 255, 255, 0.6),
    transparent
  );
}

@keyframes shimmer {
  100% { transform: translateX(100%); }
}
```

## æœ€ä½³å®è·µ

### 1. éª¨æ¶å±è®¾è®¡
- **åŒ¹é…å¸ƒå±€**ï¼šéª¨æ¶å±åº”è¯¥æ¨¡æ‹ŸçœŸå®å†…å®¹çš„å°ºå¯¸å’Œä½ç½®
- **åˆç†åŠ¨ç”»**ï¼šä½¿ç”¨ç®€æ´çš„é—ªçƒåŠ¨ç”»æç¤ºåŠ è½½çŠ¶æ€
- **ä¸€è‡´æ€§**ï¼šä¿æŒéª¨æ¶å±å’Œå®é™…å†…å®¹çš„è§†è§‰ä¸€è‡´æ€§

### 2. Suspense è¾¹ç•Œ
- **ç²’åº¦æ§åˆ¶**ï¼šåœ¨åˆé€‚çš„ç»„ä»¶çº§åˆ«è®¾ç½® Suspense è¾¹ç•Œ
- **é”™è¯¯å¤„ç†**ï¼šç»“åˆ Error Boundary å¤„ç†æ•°æ®è·å–å¤±è´¥
- **åµŒå¥—æ”¯æŒ**ï¼šå…è®¸å¤šå±‚ Suspense åµŒå¥—

### 3. æ•°æ®è·å–ç­–ç•¥
- **å¹¶è¡Œä¼˜åŒ–**ï¼šç‹¬ç«‹ç»„ä»¶è‡ªè¡Œè·å–æ•°æ®
- **ç¼“å­˜åˆ©ç”¨**ï¼šåˆç†ä½¿ç”¨ Next.js ç¼“å­˜æœºåˆ¶
- **é”™è¯¯æ¢å¤**ï¼šæä¾›ä¼˜é›…çš„é”™è¯¯å¤„ç†å’Œé‡è¯•æœºåˆ¶

## æŠ€æœ¯æ ˆæ•´åˆ

### Next.js åŠŸèƒ½
- **App Router**ï¼šåŸç”Ÿæ”¯æŒæµå¼ä¼ è¾“
- **Route Groups**ï¼š`(overview)` è¯­æ³•ç»„ç»‡è·¯ç”±
- **Loading UI**ï¼š`loading.tsx` æ–‡ä»¶çº¦å®š

### React åŠŸèƒ½
- **Suspense**ï¼šç»„ä»¶çº§åˆ«çš„åŠ è½½çŠ¶æ€ç®¡ç†
- **Server Components**ï¼šæœåŠ¡å™¨ç«¯æ•°æ®è·å–
- **Error Boundaries**ï¼šé”™è¯¯çŠ¶æ€å¤„ç†

### æ€§èƒ½ç›‘æ§
```typescript
// å¯ä»¥æ·»åŠ æ€§èƒ½ç›‘æ§
console.log('Component started loading...');
const startTime = performance.now();

// ç»„ä»¶æ¸²æŸ“å®Œæˆå
const endTime = performance.now();
console.log(`Component loaded in ${endTime - startTime}ms`);
```

## æ‰©å±•åº”ç”¨

### å…¶ä»–é¡µé¢åº”ç”¨
æµå¼ä¼ è¾“æ¨¡å¼å¯ä»¥åº”ç”¨åˆ°é¡¹ç›®çš„å…¶ä»–éƒ¨åˆ†ï¼š

```typescript
// app/dashboard/invoices/page.tsx (ç¤ºä¾‹)
export default function InvoicesPage() {
  return (
    <main>
      <Suspense fallback={<InvoicesTableSkeleton />}>
        <InvoicesTable />
      </Suspense>
    </main>
  );
}
```

### è¡¨æ ¼éª¨æ¶å±
```typescript
export function InvoicesTableSkeleton() {
  return (
    <div className="mt-6 flow-root">
      <div className="inline-block min-w-full align-middle">
        <div className="rounded-lg bg-gray-50 p-2 md:pt-0">
          <table className="hidden min-w-full text-gray-900 md:table">
            <thead>
              <tr>
                <th>Customer</th>
                <th>Email</th>
                <th>Amount</th>
                <th>Date</th>
                <th>Status</th>
              </tr>
            </thead>
            <tbody className="bg-white">
              <TableRowSkeleton />
              <TableRowSkeleton />
              <TableRowSkeleton />
            </tbody>
          </table>
        </div>
      </div>
    </div>
  );
}
```

## æ€»ç»“

æµå¼ä¼ è¾“æ˜¯ç°ä»£ Web åº”ç”¨æ€§èƒ½ä¼˜åŒ–çš„é‡è¦æŠ€æœ¯ï¼š

### âœ… å®ç°æ•ˆæœ
- **å³æ—¶å“åº”**ï¼šç”¨æˆ·ç«‹å³çœ‹åˆ°é¡µé¢ç»“æ„
- **å¹¶è¡ŒåŠ è½½**ï¼šå¤šä¸ªç»„ä»¶ç‹¬ç«‹è·å–æ•°æ®
- **å¹³æ»‘ä½“éªŒ**ï¼šéª¨æ¶å±æä¾›è§†è§‰è¿ç»­æ€§
- **æ€§èƒ½æå‡**ï¼šæ„ŸçŸ¥æ€§èƒ½æ˜¾è‘—æ”¹å–„

### ğŸ”§ æŠ€æœ¯ç‰¹ç‚¹
- **æ¶æ„é‡æ„**ï¼šä»å•ä½“é¡µé¢æ‹†åˆ†ä¸ºç‹¬ç«‹ç»„ä»¶
- **æ•°æ®è‡ªæ²»**ï¼šæ¯ä¸ªç»„ä»¶ç®¡ç†è‡ªå·±çš„æ•°æ®è·å–
- **åŠ è½½çŠ¶æ€**ï¼šå®Œæ•´çš„éª¨æ¶å±ç»„ä»¶ç³»ç»Ÿ
- **è·¯ç”±é›†æˆ**ï¼šåˆ©ç”¨ Next.js App Router ç‰¹æ€§

### ğŸš€ ä¼˜åŒ–å»ºè®®
1. **ç›‘æ§æ€§èƒ½**ï¼šè·Ÿè¸ªå„ç»„ä»¶çš„åŠ è½½æ—¶é—´
2. **ç¼“å­˜ç­–ç•¥**ï¼šåˆç†åˆ©ç”¨æ•°æ®ç¼“å­˜å‡å°‘é‡å¤è¯·æ±‚
3. **é”™è¯¯å¤„ç†**ï¼šä¸ºæ¯ä¸ª Suspense è¾¹ç•Œæ·»åŠ é”™è¯¯å¤„ç†
4. **ç”¨æˆ·åé¦ˆ**ï¼šæä¾›åŠ è½½è¿›åº¦å’ŒçŠ¶æ€æŒ‡ç¤º